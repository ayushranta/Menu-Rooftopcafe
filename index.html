<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Yashoday | Digital Ordering</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --primary: #0f1c2e; --accent: #c5a059; --bg: #fdfaf5; --white: #ffffff; --success: #28a745; --danger: #dc3545; --warning: #ffc107; --info: #17a2b8; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: #333; padding-bottom: 80px; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: var(--accent); }
        .btn-accent { background: var(--accent); color: var(--primary); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-outline { border: 1px solid #ddd; background: transparent; color: #333; }
        .full-width { width: 100%; }
        .hidden { display: none !important; }
        header { background: var(--primary); color: var(--accent); text-align: center; padding: 2rem 1rem; border-bottom: 4px solid var(--accent); position: relative; }
        .header-controls { position: absolute; top: 15px; right: 15px; display: flex; gap: 10px; }
        .header-btn { background: transparent; color: var(--accent); border: 1px solid var(--accent); padding: 5px 10px; border-radius: 4px; font-size: 0.8rem; cursor: pointer; }
        .nav-container { overflow-x: auto; white-space: nowrap; background: var(--accent); padding: 12px 0; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .nav-container a { color: var(--primary); text-decoration: none; padding: 5px 15px; font-weight: 700; font-size: 0.85rem; text-transform: uppercase; display: inline-block; border-right: 1px solid rgba(15, 28, 46, 0.1); }
        .container { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        .category-section { margin-bottom: 40px; scroll-margin-top: 80px; }
        .category-title { font-family: 'Playfair Display', serif; background: var(--primary); color: var(--accent); padding: 10px 20px; border-radius: 5px; margin-bottom: 10px; font-size: 1.2rem; text-align: center; }
        .menu-list { display: flex; flex-direction: column; gap: 2px; }
        .menu-row { background: var(--white); padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; border-left: 4px solid transparent; cursor: pointer; transition: 0.2s; }
        .menu-row:hover { border-left: 4px solid var(--accent); background: #fffdf9; }
        .item-name { font-weight: 500; font-size: 0.95rem; color: #2c3e50; }
        .item-price { font-weight: 700; color: var(--accent); font-size: 1rem; }
        .add-icon { font-size: 1.2rem; color: var(--primary); margin-left: 10px; opacity: 0.3; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: none; justify-content: center; align-items: center; padding: 20px; }
        .modal-overlay.active { display: flex; }
        .modal-card { background: white; width: 100%; max-width: 400px; border-radius: 10px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); max-height: 80vh; overflow-y: auto; }
        .close-modal { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999; float: right; }
        .cart-fab { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: var(--accent); width: 60px; height: 60px; border-radius: 50%; display: flex; justify-content: center; align-items: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); cursor: pointer; z-index: 1500; font-size: 1.5rem; border: 2px solid var(--accent); }
        .cart-count { position: absolute; top: -5px; right: -5px; background: red; color: white; font-size: 0.7rem; width: 20px; height: 20px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: bold; }
        .order-card { background: white; border: 1px solid #ddd; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid #ddd; position: relative; }
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: bold; color: white; text-transform: uppercase; float: right; }
        .bg-pending { background-color: var(--warning); color: #333; }
        .bg-accepted { background-color: var(--info); }
        .bg-completed { background-color: var(--success); }
        .bg-rejected { background-color: var(--danger); }
        .order-card.status-Pending { border-left-color: var(--warning); }
        .order-card.status-Accepted { border-left-color: var(--info); }
        .order-card.status-Completed { border-left-color: var(--success); }
        .form-group { margin-bottom: 15px; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        footer { text-align: center; padding: 30px; font-size: 0.8rem; color: #666; background: #eee; margin-top: 40px; }
    </style>
</head>
<body>

<header>
    <div class="header-controls">
        <button id="btn-my-orders" class="header-btn hidden" onclick="openMyOrdersModal()">My Orders</button>
        <button id="btn-login" class="header-btn" onclick="openLoginModal()">Login / Admin</button>
    </div>
    <p style="font-size: 0.9rem; letter-spacing: 2px; margin-bottom: 5px;">JAI JINENDRA</p>
    <h1 style="font-family: 'Playfair Display', serif; font-size: 2.5rem;">HOTEL YASHODAY</h1>
    <p style="letter-spacing: 1px; font-size: 0.9rem;">Digital Menu & Ordering</p>
</header>

<div class="nav-container">
    <a href="#tea">Tea & Coffee</a>
    <a href="#maggi">Maggi & Pasta</a>
</div>

<div class="container" id="menu-container">
    <div id="admin-panel" class="hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 class="category-title" style="margin:0;">Admin Dashboard</h2>
            <button class="btn btn-outline" onclick="logout()">Logout</button>
        </div>
        <div class="sub-category-title" style="border-bottom: 2px solid var(--accent); padding-bottom: 5px; margin-bottom: 15px; font-weight: bold; color: var(--primary);">Live Orders (Auto-Sync)</div>
        <div id="admin-orders-list">
            <p style="text-align: center; color: #888;">Connecting to database...</p>
        </div>
    </div>

    <div id="customer-view">
        <section id="tea" class="category-section">
            <h2 class="category-title">Tea & Coffee</h2>
            <div class="menu-list">
                <div class="menu-row" onclick="openItemModal('Classic Tea', 30)"><span class="item-name">Classic Tea</span><div><span class="item-price">30</span><span class="add-icon">+</span></div></div>
                <div class="menu-row" onclick="openItemModal('Black Tea', 30)"><span class="item-name">Black Tea</span><div><span class="item-price">30</span><span class="add-icon">+</span></div></div>
                <div class="menu-row" onclick="openItemModal('Hot Coffee', 40)"><span class="item-name">Hot Coffee</span><div><span class="item-price">40</span><span class="add-icon">+</span></div></div>
                <div class="menu-row" onclick="openItemModal('Cappuccino', 60)"><span class="item-name">Cappuccino</span><div><span class="item-price">60</span><span class="add-icon">+</span></div></div>
            </div>
        </section>

        <section id="maggi" class="category-section">
            <h2 class="category-title">Maggi & Pasta</h2>
            <div class="menu-list">
                <div class="menu-row" onclick="openItemModal('Classic Maggi', 30)"><span class="item-name">Classic Maggi</span><div><span class="item-price">30</span><span class="add-icon">+</span></div></div>
                <div class="menu-row" onclick="openItemModal('Cheese Maggi', 60)"><span class="item-name">Cheese Maggi</span><div><span class="item-price">60</span><span class="add-icon">+</span></div></div>
                <div class="menu-row" onclick="openItemModal('Veg Sandwich', 60)"><span class="item-name">Veg Sandwich</span><div><span class="item-price">60</span><span class="add-icon">+</span></div></div>
                <div class="menu-row" onclick="openItemModal('Red Sauce Pasta', 160)"><span class="item-name">Red Sauce Pasta</span><div><span class="item-price">160</span><span class="add-icon">+</span></div></div>
            </div>
        </section>
        
        <div style="text-align:center; padding: 20px; color:#888;">
            (Short Menu Active)
        </div>
    </div>
</div>

<footer><p>&copy; 2026 Hotel Yashoday. All Rights Reserved.</p></footer>

<div class="cart-fab" onclick="openCartModal()">ðŸ›’<span class="cart-count" id="cart-count">0</span></div>

<div class="modal-overlay" id="item-modal">
    <div class="modal-card">
        <button class="close-modal" onclick="closeModal('item-modal')">&times;</button>
        <h3 id="modal-item-name" style="margin-bottom: 10px; margin-top: 0;">Item</h3>
        <p style="color: var(--accent); font-weight: bold; font-size: 1.2rem; margin-bottom: 20px;">â‚¹<span id="modal-item-price">0</span></p>
        <div class="form-group">
            <label>Quantity</label>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-outline" onclick="adjustModalQty(-1)">-</button>
                <input type="number" id="modal-qty" value="1" style="width: 50px; text-align: center;" readonly>
                <button class="btn btn-outline" onclick="adjustModalQty(1)">+</button>
            </div>
        </div>
        <button class="btn btn-primary full-width" onclick="confirmAddToCart()">Add to Cart</button>
    </div>
</div>

<div class="modal-overlay" id="cart-modal">
    <div class="modal-card">
        <button class="close-modal" onclick="closeModal('cart-modal')">&times;</button>
        <h3 style="margin-top:0;">Your Cart</h3>
        <div id="cart-items-container" style="margin-top: 15px;"><p>Your cart is empty.</p></div>
        <div style="margin-top: 20px; border-top: 2px solid #eee; padding-top: 15px;">
            <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2rem;"><span>Total</span><span>â‚¹<span id="cart-total">0</span></span></div>
            <br><button class="btn btn-success full-width" onclick="initiateCheckout()">Place Order</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="login-modal">
    <div class="modal-card">
        <button class="close-modal" onclick="closeModal('login-modal')">&times;</button>
        <h3 style="margin-top:0;">Login</h3>
        <div style="display: flex; margin-bottom: 20px; border-bottom: 1px solid #ddd; margin-top: 15px;">
            <button class="btn full-width" id="tab-customer" onclick="switchLoginTab('customer')" style="background:var(--accent); color: white;">Customer</button>
            <button class="btn full-width" id="tab-admin" onclick="switchLoginTab('admin')" style="background: #eee;">Admin</button>
        </div>
        <div id="form-customer">
            <div class="form-group"><label>Phone Number</label><input type="tel" id="cust-phone" class="form-control" placeholder="Mobile Number"></div>
            <div class="form-group"><label>Name</label><input type="text" id="cust-name" class="form-control" placeholder="Enter Name"></div>
            <div class="form-group"><label>Table No</label><input type="text" id="cust-table" class="form-control" placeholder="e.g. 5"></div>
            <button class="btn btn-primary full-width" onclick="handleCustomerLogin()">Start Ordering</button>
        </div>
        <div id="form-admin" class="hidden">
            <div class="form-group"><label>Admin ID</label><input type="text" id="admin-id" class="form-control"></div>
            <div class="form-group"><label>Password</label><input type="password" id="admin-pass" class="form-control"></div>
            <button class="btn btn-primary full-width" onclick="handleAdminLogin()">Admin Login</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="my-orders-modal">
    <div class="modal-card">
        <button class="close-modal" onclick="closeModal('my-orders-modal')">&times;</button>
        <h3 style="margin-top:0;">My Orders</h3>
        <div id="my-orders-list" style="margin-top: 15px;"></div>
        <p style="text-align:center; font-size: 0.8rem; margin-top:10px; color:#666;">Status updates automatically.</p>
    </div>
</div>

<script>
    // ==============================================================
    // FIREBASE CONFIG
    // ==============================================================
    const firebaseConfig = {
        apiKey: "AIzaSyB34STsFkbB4l-tnFqpi1Cx-1GMZwd3Lyc",
        authDomain: "hotel-yashoday.firebaseapp.com",
        databaseURL: "https://hotel-yashoday-default-rtdb.firebaseio.com",
        projectId: "hotel-yashoday",
        storageBucket: "hotel-yashoday.firebasestorage.app",
        messagingSenderId: "432219813043",
        appId: "1:432219813043:web:ce1533fce441b869ebecc6",
        measurementId: "G-BNQBD76YH5"
    };

    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const db = firebase.database();
    // ==============================================================

    let cart = [];
    let currentUser = null; 
    let currentItemToAdd = null;

    document.addEventListener('DOMContentLoaded', () => { checkSession(); });

    function checkSession() {
        const storedUser = localStorage.getItem('yashoday_user');
        if (storedUser) {
            currentUser = JSON.parse(storedUser);
            if (currentUser.type === 'admin') { showAdminDashboard(); }
            else { updateHeaderUser(); listenToMyOrders(); }
        }
    }

    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    // --- ITEM & CART ---
    function openItemModal(name, price) {
        currentItemToAdd = { name, price };
        document.getElementById('modal-item-name').innerText = name;
        document.getElementById('modal-item-price').innerText = price;
        document.getElementById('modal-qty').value = 1;
        openModal('item-modal');
    }
    function adjustModalQty(change) {
        const input = document.getElementById('modal-qty');
        let val = parseInt(input.value) + change;
        if (val < 1) val = 1;
        input.value = val;
    }
    function confirmAddToCart() {
        const qty = parseInt(document.getElementById('modal-qty').value);
        addToCart(currentItemToAdd.name, currentItemToAdd.price, qty);
        closeModal('item-modal');
    }
    function addToCart(name, price, qty) {
        const existing = cart.find(item => item.name === name);
        if (existing) { existing.qty += qty; } else { cart.push({ name, price, qty }); }
        updateCartUI();
    }
    function removeFromCart(index) {
        cart.splice(index, 1);
        updateCartUI();
    }
    function updateCartUI() {
        document.getElementById('cart-count').innerText = cart.length;
        const container = document.getElementById('cart-items-container');
        let html = '';
        let total = 0;
        if (cart.length === 0) { html = '<p style="text-align:center; color:#999;">Cart is empty.</p>'; }
        else {
            cart.forEach((item, index) => {
                const itemTotal = item.price * item.qty;
                total += itemTotal;
                html += `<div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px dashed #ddd; padding-bottom:5px;">
                            <div><b>${item.name}</b><br><small>â‚¹${item.price} x ${item.qty}</small></div>
                            <div style="text-align:right;"><b>â‚¹${itemTotal}</b> <span onclick="removeFromCart(${index})" style="color:red; cursor:pointer; margin-left:10px;">X</span></div>
                         </div>`;
            });
        }
        container.innerHTML = html;
        document.getElementById('cart-total').innerText = total;
    }
    function openCartModal() { updateCartUI(); openModal('cart-modal'); }

    // --- AUTH ---
    function openLoginModal() { if (currentUser) { if(confirm("Are you sure you want to logout?")) logout(); } else { openModal('login-modal'); } }
    function switchLoginTab(type) {
        const custBtn = document.getElementById('tab-customer');
        const adminBtn = document.getElementById('tab-admin');
        const custForm = document.getElementById('form-customer');
        const adminForm = document.getElementById('form-admin');
        if (type === 'customer') {
            custBtn.style.background = 'var(--accent)'; custBtn.style.color = 'white';
            adminBtn.style.background = '#eee'; adminBtn.style.color = 'black';
            custForm.classList.remove('hidden'); adminForm.classList.add('hidden');
        } else {
            adminBtn.style.background = 'var(--primary)'; adminBtn.style.color = 'white';
            custBtn.style.background = '#eee'; custBtn.style.color = 'black';
            adminForm.classList.remove('hidden'); custForm.classList.add('hidden');
        }
    }
    function handleCustomerLogin() {
        const name = document.getElementById('cust-name').value;
        const table = document.getElementById('cust-table').value;
        const phone = document.getElementById('cust-phone').value;
        if (!name || !table || !phone) { alert("Please fill all details."); return; }
        currentUser = { type: 'customer', name, table, phone };
        localStorage.setItem('yashoday_user', JSON.stringify(currentUser));
        closeModal('login-modal');
        updateHeaderUser();
        listenToMyOrders();
        if (cart.length > 0) initiateCheckout();
    }
    function handleAdminLogin() {
        const id = document.getElementById('admin-id').value;
        const pass = document.getElementById('admin-pass').value;
        if (id === 'admin' && pass === 'admin123') {
            currentUser = { type: 'admin', name: 'Manager' };
            localStorage.setItem('yashoday_user', JSON.stringify(currentUser));
            closeModal('login-modal');
            showAdminDashboard();
        } else { alert("Invalid Credentials"); }
    }
    function logout() { localStorage.removeItem('yashoday_user'); location.reload(); }
    function updateHeaderUser() {
        const btn = document.getElementById('btn-login');
        btn.innerText = `Hi, ${currentUser.name}`;
        document.getElementById('btn-my-orders').classList.remove('hidden');
    }

    // --- CHECKOUT ---
    function initiateCheckout() {
        if (cart.length === 0) { alert("Cart is empty!"); return; }
        if (!currentUser) { alert("Please Login."); openLoginModal(); return; }
        if (currentUser.type === 'admin') { alert("Admins cannot order."); return; }

        const orderId = 'ORD-' + Date.now();
        const newOrder = {
            id: orderId,
            customer: currentUser,
            items: cart,
            total: parseInt(document.getElementById('cart-total').innerText),
            status: 'Pending',
            timestamp: new Date().toLocaleTimeString(),
            createdAt: firebase.database.ServerValue.TIMESTAMP
        };

        db.ref('orders/' + orderId).set(newOrder).then(() => {
            cart = []; updateCartUI(); closeModal('cart-modal'); openMyOrdersModal();
        });
    }

    // --- LIVE UPDATES ---
    function listenToMyOrders() {
        if (!currentUser || currentUser.type === 'admin') return;
        db.ref('orders').orderByChild('customer/phone').equalTo(currentUser.phone).on('value', (snapshot) => {
            const orders = [];
            snapshot.forEach((child) => orders.push(child.val()));
            // SAFETY SORT
            orders.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
            window.myLiveOrders = orders;
            if (document.getElementById('my-orders-modal').classList.contains('active')) renderMyOrders();
        });
    }
    function openMyOrdersModal() { if (!currentUser) return; renderMyOrders(); openModal('my-orders-modal'); }
    
    function renderMyOrders() {
        const container = document.getElementById('my-orders-list');
        const activeOrders = (window.myLiveOrders || []).filter(o => o.status === 'Pending' || o.status === 'Accepted');
        if (activeOrders.length === 0) { container.innerHTML = '<p style="text-align:center;">No active orders.</p>'; return; }
        let html = '';
        activeOrders.forEach(order => {
            // FIX: THE CRITICAL FIX FOR CUSTOMER PAGE
            let itemsArr = order.items;
            if (!Array.isArray(itemsArr) && itemsArr) {
                itemsArr = Object.values(itemsArr);
            }
            const summary = (itemsArr || []).map(i => `${i.name} (${i.qty})`).join(', ');
            
            html += `<div style="background:#f9f9f9; padding:10px; margin-bottom:10px; border-radius:5px; border-left:4px solid ${order.status==='Pending'?'orange':'#17a2b8'};">
                        <div style="display:flex; justify-content:space-between;"><b>#${order.id.slice(-6)}</b> <span>${order.status}</span></div>
                        <div style="font-size:0.9rem; color:#555;">${summary}</div>
                        <div style="text-align:right;"><b>â‚¹${order.total}</b></div>
                     </div>`;
        });
        container.innerHTML = html;
    }

    // --- ADMIN DASHBOARD ---
    function showAdminDashboard() {
        document.getElementById('customer-view').classList.add('hidden');
        document.getElementById('admin-panel').classList.remove('hidden');
        document.querySelector('.cart-fab').classList.add('hidden');
        document.getElementById('btn-login').innerText = "Admin Panel";
        document.getElementById('btn-my-orders').classList.add('hidden');

        db.ref('orders').on('value', (snapshot) => {
            const orders = [];
            if (snapshot.exists()) {
                snapshot.forEach((child) => orders.push(child.val()));
                // SAFETY SORT
                orders.sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0));
            }
            renderAdminOrders(orders);
        });
    }

    function renderAdminOrders(allOrders) {
        const container = document.getElementById('admin-orders-list');
        if (allOrders.length === 0) { container.innerHTML = '<p style="text-align:center;">No orders found.</p>'; return; }
        let html = '';
        allOrders.forEach(order => {
            // FIX: THE CRITICAL FIX FOR ADMIN PAGE
            let itemsArr = order.items;
            if (!Array.isArray(itemsArr) && itemsArr) {
                itemsArr = Object.values(itemsArr);
            }
            const summary = (itemsArr || []).map(i => `${i.name} (x${i.qty})`).join(', ');

            let actions = '';
            if (order.status === 'Pending') {
                actions = `<button class="btn btn-primary" onclick="updateStatus('${order.id}', 'Accepted')">Accept</button>
                           <button class="btn btn-danger" onclick="updateStatus('${order.id}', 'Rejected')">Reject</button>`;
            } else if (order.status === 'Accepted') {
                actions = `<button class="btn btn-success" onclick="updateStatus('${order.id}', 'Completed')">Complete</button>`;
            } else {
                actions = `<b>${order.status}</b>`;
            }

            html += `<div style="background:white; border:1px solid #ddd; padding:15px; border-radius:5px; margin-bottom:15px; border-left: 5px solid ${order.status==='Pending'?'orange':(order.status==='Accepted'?'#17a2b8':'green')}">
                        <div style="display:flex; justify-content:space-between; color:#666; font-size:0.9rem;">
                            <span>#${order.id.slice(-6)} | ${order.timestamp}</span> <span>${order.status}</span>
                        </div>
                        <div style="font-weight:bold; font-size:1.1rem; color:var(--primary); margin:5px 0;">
                            ${order.customer.table} - ${order.customer.name} <small>(${order.customer.phone})</small>
                        </div>
                        <div style="margin-bottom:10px;">${summary}</div>
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-weight:bold; font-size:1.1rem;">â‚¹${order.total}</span>
                            <div style="display:flex; gap:5px;">${actions}</div>
                        </div>
                     </div>`;
        });
        container.innerHTML = html;
    }

    function updateStatus(id, status) {
        db.ref('orders/' + id).update({ status: status });
    }
</script>
</body>
</html>
